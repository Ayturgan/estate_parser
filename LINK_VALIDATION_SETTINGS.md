# Настройки валидации ссылок

## Описание

Новый этап валидации ссылок проверяет все ссылки на источники объявлений в базе данных и удаляет объявления с невалидными ссылками (404, 410 ошибки).

## Настройки

### 1. enable_link_validation
- **Тип**: boolean
- **По умолчанию**: true
- **Описание**: Включить/выключить этап валидации ссылок в пайплайне

### 2. link_validation_batch_size
- **Тип**: integer
- **По умолчанию**: 500
- **Диапазон**: 50-2000
- **Описание**: Количество ссылок, обрабатываемых одновременно

## Рекомендации по настройке

### Для больших объемов данных (100k+ объявлений):
- `link_validation_batch_size`: 500-1000
- Увеличьте лимит соединений в коде до 100-200

### Для средних объемов (10k-100k объявлений):
- `link_validation_batch_size`: 200-500

### Для малых объемов (<10k объявлений):
- `link_validation_batch_size`: 100-200

## Исключенные домены

По умолчанию исключается проверка ссылок с домена `agency.kg` (как было запрошено).

## Изменение размера батча

### Через веб-интерфейс:
1. Перейдите в Настройки → Обработка данных
2. Найдите "Размер батча валидации ссылок"
3. Установите нужное значение (50-2000)

### Через API:
```bash
curl -X POST "http://localhost:8000/api/settings/link_validation_batch_size" \
     -H "Content-Type: application/json" \
     -d '{"value": 1000}'
```

### Программно:
```python
from app.services.settings_service import settings_service

settings_service.set_setting('link_validation_batch_size', 1000, 'int')
```

## Производительность

- **Время обработки**: ~2-5 секунд на 1000 ссылок (зависит от скорости интернета)
- **Память**: ~50-100 МБ на 1000 ссылок
- **Сеть**: До 100 одновременных HTTP-запросов

## Мониторинг

Прогресс валидации можно отслеживать через:
- Веб-интерфейс в разделе Автоматизация
- API endpoint: `GET /api/validate/links/status`
- Логи приложения 