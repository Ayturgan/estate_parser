{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ - Estate Parser{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-people me-2"></i>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Å–∏—Å—Ç–µ–º—ã
                    </h5>
                    <span class="badge bg-secondary">{{ admins|length }} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
                </div>
                <div class="card-body">
                    {% if error %}
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
                    </div>
                    {% endif %}
                    
                    {% if success %}
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle me-2"></i>{{ success }}
                    </div>
                    {% endif %}
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>ID</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–ü–æ–ª–Ω–æ–µ –∏–º—è</th>
                                    <th>–°–æ–∑–¥–∞–Ω</th>
                                    <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for admin in admins %}
                                <tr>
                                    <td>{{ admin.id }}</td>
                                    <td>
                                        <strong>{{ admin.username }}</strong>
                                        {% if admin.id == current_admin.id %}
                                        <span class="badge bg-primary ms-1">–í—ã</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ admin.full_name or '‚Äî' }}</td>
                                    <td>{{ admin.created_at.strftime('%d.%m.%Y') }}</td>
                                    <td>
                                        {% if admin.last_login_at %}
                                            {{ admin.last_login_at.strftime('%d.%m.%Y %H:%M') }}
                                        {% else %}
                                            <span class="text-muted">–ù–∏–∫–æ–≥–¥–∞</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if admin.is_active %}
                                            <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                        {% else %}
                                            <span class="badge bg-danger">–û—Ç–∫–ª—é—á–µ–Ω</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-person-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" action="/admin/users/create">
                        <div class="mb-3">
                            <label for="username" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è*</label>
                            <input type="text" class="form-control" id="username" name="username" 
                                   required placeholder="admin">
                            <div class="form-text">–¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="password" class="form-label">–ü–∞—Ä–æ–ª—å*</label>
                            <input type="password" class="form-control" id="password" name="password" 
                                   required placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
                        </div>
                        
                        <div class="mb-3">
                            <label for="full_name" class="form-label">–ü–æ–ª–Ω–æ–µ –∏–º—è</label>
                            <input type="text" class="form-control" id="full_name" name="full_name"
                                   placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-plus-circle me-2"></i>–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
                        </button>
                    </form>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="bi bi-info-circle me-2"></i>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="/" class="btn btn-outline-primary">
                            <i class="bi bi-card-list me-2"></i>–û–±—ä—è–≤–ª–µ–Ω–∏—è
                        </a>
                        <a href="/dashboard" class="btn btn-outline-secondary">
                            <i class="bi bi-speedometer2 me-2"></i>–î–∞—à–±–æ—Ä–¥
                        </a>
                        <a href="/automation" class="btn btn-outline-info">
                            <i class="bi bi-gear me-2"></i>–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
document.addEventListener('DOMContentLoaded', function() {
    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ WebSocket —Å–æ–±—ã—Ç–∏–π
    if (window.realtimeClient) {
        console.log('üì° WebSocket –∫–ª–∏–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        window.realtimeClient.on('user_created', function(data) {
            console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω:', data);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            if (window.showNotification) {
                window.showNotification('success', `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω: ${data.username}`);
            }
            
            // –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
            setTimeout(() => {
                if (confirm('–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å! –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É?')) {
                    window.location.reload();
                }
            }, 1000);
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        window.realtimeClient.on('user_login', function(data) {
            console.log('üîë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', data);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            if (data.username !== '{{ current_admin.username }}') {
                if (window.showNotification) {
                    window.showNotification('info', `–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É: ${data.username}`);
                }
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
        window.realtimeClient.on('system_status', function(data) {
            console.log('‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ:', data);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            if (window.showNotification) {
                window.showNotification('info', data.message || '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã');
            }
        });
    } else {
        console.log('‚ö†Ô∏è WebSocket –∫–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏');
    }
});
</script>
{% endblock %} 